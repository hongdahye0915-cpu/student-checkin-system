<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë©´í•™ì‹œê°„ ììœ¨ ì²´í¬ì¸</title>
    <style>
        body { font-family: 'Arial', sans-serif; padding: 30px; background-color: #f4f7f6; }
        .container { max-width: 500px; margin: 0 auto; padding: 25px; background-color: white; border-radius: 10px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); }
        h1 { text-align: center; color: #2c3e50; margin-bottom: 30px; }
        label { display: block; margin-bottom: 8px; font-weight: bold; color: #34495e; }
        input[type="text"], select { width: 100%; padding: 12px; margin-bottom: 20px; border: 1px solid #ddd; border-radius: 5px; box-sizing: border-box; font-size: 16px; }
        button { width: 100%; padding: 15px; background-color: #3498db; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 18px; font-weight: bold; transition: background-color 0.3s; }
        button:hover { background-color: #2980b9; }
        #checkin-status { text-align: center; margin-top: 25px; padding: 10px; border-radius: 5px; }
        
        /* ğŸš¨ ë¹„ë°€ë²ˆí˜¸ ë³´í˜¸ ì˜ì—­ ìŠ¤íƒ€ì¼ */
        #content-area { display: none; } /* ê¸°ë³¸ì ìœ¼ë¡œ ë‚´ìš© ìˆ¨ê¹€ */
        #password-prompt { 
            max-width: 400px; margin: 100px auto; padding: 20px; border: 1px solid #ccc; border-radius: 8px; 
            text-align: center; background-color: #ffe0e0; 
        }
    </style>
</head>
<body>
    
    <div id="password-prompt">
        <h2>ğŸ”’ ì ‘ê·¼ ë³´í˜¸</h2>
        <p>ì›¹ì‚¬ì´íŠ¸ì— ì ‘ì†í•˜ë ¤ë©´ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.</p>
        <input type="password" id="access-password" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥">
        <button onclick="checkPassword()">ì ‘ì†</button>
        <p id="password-message" style="color: red; margin-top: 10px;"></p>
    </div>

    <div id="content-area">
        <div class="container">
            <h1>ë©´í•™ì‹œê°„ ììœ¨ ì²´í¬ì¸ ğŸ“</h1>
            <p style="text-align: center; color: #e74c3c; font-weight: bold;">(ë§¤ì¼ ìì •ì— ë°ì´í„°ê°€ ì´ˆê¸°í™”ë©ë‹ˆë‹¤.)</p>

            <label for="student-id">í•™ë²ˆ ì…ë ¥ (ì˜ˆ: 10101)</label>
            <input type="text" id="student-id" placeholder="5ìë¦¬ í•™ë²ˆì„ ì…ë ¥í•˜ì„¸ìš”">

            <label for="classroom-select">ë©´í•™ ì¥ì†Œ ì„ íƒ</label>
            <select id="classroom-select" onchange="toggleOtherInput()">
                </select>
            
            <div id="other-location-group" style="display: none;">
                <label for="other-location">ìƒì„¸ ì¥ì†Œ ì§ì ‘ ì…ë ¥</label>
                <input type="text" id="other-location" placeholder="ì˜ˆ: 2ì¸µ ë³µë„, ê³¼í•™ì‹¤">
            </div>

            <button onclick="checkIn()">ì²´í¬ì¸ í•˜ê¸°</button>
            <div id="checkin-status"></div>
        </div>
    </div>


    <script>
        // -------------------------------------
        // ğŸš¨ ë¹„ë°€ë²ˆí˜¸ í™•ì¸ ë¡œì§
        // -------------------------------------
        const CORRECT_PASSWORD = "hanmin"; // âœ… ì„¤ì •í•œ ë¹„ë°€ë²ˆí˜¸

        function checkPassword() {
            const inputElement = document.getElementById('access-password');
            const password = inputElement.value;
            const messageElement = document.getElementById('password-message');
            const contentArea = document.getElementById('content-area');
            const promptArea = document.getElementById('password-prompt');

            if (password === CORRECT_PASSWORD) {
                promptArea.style.display = 'none'; // ë¹„ë°€ë²ˆí˜¸ ì°½ ìˆ¨ê¸°ê¸°
                contentArea.style.display = 'block'; // ì½˜í…ì¸  ì˜ì—­ í‘œì‹œ
                initializePage(); // í˜ì´ì§€ ì½˜í…ì¸  ì´ˆê¸°í™” í•¨ìˆ˜ ì‹¤í–‰
            } else {
                messageElement.textContent = "ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.";
                inputElement.value = ''; // ì…ë ¥ê°’ ì´ˆê¸°í™”
            }
        }
        
        // -------------------------------------
        // 1. ê³µí†µ ì„¤ì • ë° ë°ì´í„° í‚¤
        // -------------------------------------
        const LOCATIONS = [
            "1ë°˜", "2ë°˜", "3ë°˜", "4ë°˜", "5ë°˜", "6ë°˜", "7ë°˜",
            "8ë°˜", "9ë°˜", "10ë°˜", "11ë°˜", "12ë°˜", "13ë°˜",
            "ì»¨í¼ëŸ°ìŠ¤í™€", "í™ˆë² ì´ìŠ¤", "ê¸°íƒ€"
        ];
        const DATA_KEY = 'dailyCheckinData'; 
        const ROSTER_KEY = 'fullRoster'; 

        function getTodayDate() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            return `${year}${month}${day}`;
        }

        function loadCheckinData() {
            const today = getTodayDate();
            let storedData;
            try {
                storedData = JSON.parse(localStorage.getItem(DATA_KEY));
            } catch (e) {
                storedData = null;
            }
            
            if (!storedData || storedData.date !== today) {
                const initialData = { date: today, checkins: [] };
                localStorage.setItem(DATA_KEY, JSON.stringify(initialData));
                return initialData.checkins;
            }

            return storedData.checkins;
        }

        function saveCheckinData(checkinArray) {
            const today = getTodayDate();
            const dataToSave = { date: today, checkins: checkinArray };
            localStorage.setItem(DATA_KEY, JSON.stringify(dataToSave));
        }
        
        function loadFullRoster() {
            try {
                const rosterString = localStorage.getItem(ROSTER_KEY);
                return rosterString ? JSON.parse(rosterString) : [];
            } catch (e) {
                return [];
            }
        }

        // -------------------------------------
        // 2. ê¸°íƒ€ ì…ë ¥ í† ê¸€ í•¨ìˆ˜
        // -------------------------------------
        function toggleOtherInput() {
            const selectElement = document.getElementById('classroom-select');
            const otherGroup = document.getElementById('other-location-group');
            
            if (selectElement.value === 'ê¸°íƒ€') {
                otherGroup.style.display = 'block';
            } else {
                otherGroup.style.display = 'none';
            }
        }

        // -------------------------------------
        // 3. ì´ˆê¸°í™” ë° ì˜µì…˜ ì„¤ì •
        // -------------------------------------
        function initializePage() {
            const selectElement = document.getElementById('classroom-select');
            selectElement.innerHTML = ''; 
            
            LOCATIONS.forEach(loc => {
                const option = document.createElement('option');
                option.value = loc;
                option.textContent = loc;
                selectElement.appendChild(option);
            });
            
            loadCheckinData(); 
            toggleOtherInput();
        }

        // -------------------------------------
        // 4. ì²´í¬ì¸ ë¡œì§
        // -------------------------------------
        function checkIn() {
            const studentId = document.getElementById('student-id').value.trim();
            let classroom = document.getElementById('classroom-select').value;
            const otherLocation = document.getElementById('other-location').value.trim();
            const statusElement = document.getElementById('checkin-status');
            const now = new Date();
            const timeString = now.toLocaleTimeString('ko-KR');
            
            if (!/^\d{5}$/.test(studentId)) {
                statusElement.textContent = "âš ï¸ í•™ë²ˆì€ 5ìë¦¬ ìˆ«ìë¡œ ì •í™•íˆ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.";
                statusElement.style.backgroundColor = '#f39c12'; statusElement.style.color = 'white';
                return;
            }

            const fullRoster = loadFullRoster();
            if (!fullRoster.includes(studentId)) {
                statusElement.textContent = "âš ï¸ í•´ë‹¹ í•™ë²ˆì€ ëª…ë‹¨ì— ë“±ë¡ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. (ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜)";
                statusElement.style.backgroundColor = '#f39c12'; statusElement.style.color = 'white';
                return;
            }

            if (classroom === 'ê¸°íƒ€') {
                if (otherLocation === '') {
                    statusElement.textContent = "âš ï¸ 'ê¸°íƒ€'ë¥¼ ì„ íƒí–ˆìœ¼ë¯€ë¡œ ìƒì„¸ ì¥ì†Œë¥¼ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.";
                    statusElement.style.backgroundColor = '#f39c12'; statusElement.style.color = 'white';
                    return;
                }
                classroom = `ê¸°íƒ€ (${otherLocation})`;
            }

            let checkinData = loadCheckinData();
            const existingIndex = checkinData.findIndex(item => item.id === studentId);

            const newRecord = { 
                id: studentId, 
                classroom: classroom,
                time: timeString 
            };

            if (existingIndex !== -1) {
                checkinData[existingIndex] = newRecord;
                statusElement.textContent = `${studentId}ë‹˜, ì²´í¬ì¸ ì •ë³´ë¥¼ ${classroom}ìœ¼ë¡œ ì—…ë°ì´íŠ¸í–ˆìŠµë‹ˆë‹¤! (${timeString})`;
            } else {
                checkinData.push(newRecord);
                statusElement.textContent = `${studentId}ë‹˜, ${classroom}ìœ¼ë¡œ ì²´í¬ì¸ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. (${timeString})`;
            }

            saveCheckinData(checkinData);

            statusElement.style.backgroundColor = '#2ecc71';
            statusElement.style.color = 'white';
        }

    </script>
</body>
</html>
