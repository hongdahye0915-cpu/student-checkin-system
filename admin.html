<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</title>
    <style>
        body { font-family: 'Arial', sans-serif; padding: 20px; background-color: #ecf0f1; }
        .container { max-width: 1000px; margin: 0 auto; padding: 30px; background-color: white; border-radius: 10px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); }
        h1 { color: #e74c3c; text-align: center; margin-bottom: 30px; }
        .summary { display: flex; justify-content: space-around; margin-bottom: 30px; text-align: center; }
        .summary-box { padding: 20px; border-radius: 8px; flex-basis: 30%; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05); }
        .summary-box h4 { margin-top: 0; color: #2c3e50; }
        .summary-box p { font-size: 28px; font-weight: bold; margin: 5px 0; }
        #checked-box { background-color: #d4f7d4; color: #27ae60; }
        #missing-box { background-color: #f7d4d4; color: #c0392b; }
        #total-box { background-color: #d4e7f7; color: #3498db; }
        
        h2 { border-bottom: 2px solid #bdc3c7; padding-bottom: 5px; margin-top: 40px; color: #2c3e50; }
        
        .list-table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        .list-table th, .list-table td { border: 1px solid #ddd; padding: 10px; text-align: left; }
        .list-table th { background-color: #f2f2f2; }
        
        .missing-list { background-color: #f7f7f7; padding: 15px; border: 1px solid #c0392b; border-radius: 5px; }
        .missing-list span { display: inline-block; padding: 5px 8px; margin: 4px; background-color: #e74c3c; color: white; border-radius: 3px; font-weight: bold; }

        .management-section { background-color: #eaf2f8; padding: 20px; border-radius: 8px; margin-top: 30px; }
        .roster-input-group { display: flex; gap: 10px; margin-bottom: 15px; }
        .roster-input-group input { flex-grow: 1; padding: 10px; border: 1px solid #ccc; border-radius: 5px; }
        .roster-input-group button { padding: 10px 15px; background-color: #2ecc71; color: white; border: none; border-radius: 5px; cursor: pointer; }
        .roster-input-group button.delete { background-color: #e74c3c; }
        #roster-display { background-color: white; padding: 10px; border: 1px solid #ddd; border-radius: 5px; max-height: 200px; overflow-y: auto; }
        #roster-status { margin-top: 10px; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ë©´í•™ ì¸ì› ì ê²€ ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ ğŸ“Š</h1>
        <p style="text-align: right; color: #34495e;">í˜„ì¬ ë‚ ì§œ: <span id="current-date"></span></p>
        <button onclick="updateDashboard()" style="width: 100%; padding: 10px; background-color: #1abc9c; color: white; border: none; border-radius: 5px; cursor: pointer; margin-bottom: 20px;">í˜„í™© ìƒˆë¡œê³ ì¹¨</button>

        <div class="summary">
            <div id="total-box" class="summary-box">
                <h4>ì´ ì¸ì›</h4>
                <p id="total-count">0</p>
            </div>
            <div id="checked-box" class="summary-box">
                <h4>ì²´í¬ì¸ ì™„ë£Œ</h4>
                <p id="checked-count">0</p>
            </div>
            <div id="missing-box" class="summary-box">
                <h4>ë¯¸ì²´í¬ ì¸ì›</h4>
                <p id="missing-count">0</p>
            </div>
        </div>

        <h2>ğŸš« ë¯¸ì²´í¬ í•™ìƒ ëª©ë¡ (í•™ë²ˆ)</h2>
        <div id="missing-students-list" class="missing-list">
            </div>

        <h2>âœ… ì²´í¬ì¸ ì™„ë£Œ ëª…ë‹¨</h2>
        <table class="list-table">
            <thead>
                <tr><th>í•™ë²ˆ</th><th>ë°˜</th><th>ë²ˆí˜¸</th><th>ì²´í¬ì¸ ì¥ì†Œ</th><th>ì‹œê°„</th></tr>
            </thead>
            <tbody id="checkin-table-body">
                </tbody>
        </table>

        <div class="management-section">
            <h2>âš™ï¸ í•™ìƒ ëª…ë‹¨ ê´€ë¦¬ (ì´ ëª…ë‹¨: <span id="current-roster-count">0</span>ëª…)</h2>
            <div id="roster-management">
                <div id="roster-setup">
                    <p style="color: #e74c3c; font-weight: bold;">ëª…ë‹¨ì´ ë¹„ì–´ ìˆìŠµë‹ˆë‹¤. ì´ˆê¸° ëª…ë‹¨(1í•™ë…„ ì „ì²´)ì„ ìƒì„±í•˜ê±°ë‚˜ ì•„ë˜ì—ì„œ ìˆ˜ë™ìœ¼ë¡œ ì¶”ê°€í•˜ì„¸ìš”.</p>
                    <button onclick="generateAndSaveInitialRoster()" style="background-color: #3498db;">ì´ˆê¸° 10101~11330 ëª…ë‹¨ ìë™ ìƒì„±</button>
                    <hr>
                </div>
                
                <div class="roster-input-group">
                    <input type="text" id="roster-id-input" placeholder="ì¶”ê°€/ì‚­ì œí•  5ìë¦¬ í•™ë²ˆ ì…ë ¥ (ì˜ˆ: 20101)">
                    <button onclick="addStudent()">í•™ë²ˆ ì¶”ê°€</button>
                    <button onclick="deleteStudent()" class="delete">í•™ë²ˆ ì‚­ì œ</button>
                </div>
            </div>
            <p id="roster-status"></p>
            <h3>í˜„ì¬ ë“±ë¡ëœ í•™ë²ˆ ëª©ë¡</h3>
            <div id="roster-display"></div>
        </div>
    </div>

    <script>
        // -------------------------------------
        // 1. ê³µí†µ ì„¤ì • ë° ë°ì´í„° í‚¤
        // -------------------------------------
        const TOTAL_CLASSES = 13;
        const STUDENTS_PER_CLASS = 30;
        const DATA_KEY = 'dailyCheckinData'; 
        const ROSTER_KEY = 'fullRoster'; 

        // -------------------------------------
        // 2. ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
        // -------------------------------------
        function getTodayDate() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            return `${year}${month}${day}`;
        }
        
        function loadCheckinData() {
            const today = getTodayDate();
            let storedData;
            try {
                storedData = JSON.parse(localStorage.getItem(DATA_KEY));
            } catch (e) {
                return [];
            }
            if (storedData && storedData.date === today) {
                return storedData.checkins;
            }
            return [];
        }

        function loadFullRoster() {
            try {
                const rosterString = localStorage.getItem(ROSTER_KEY);
                return rosterString ? JSON.parse(rosterString) : [];
            } catch (e) {
                return [];
            }
        }
        
        function saveFullRoster(rosterArray) {
            rosterArray.sort((a, b) => a.localeCompare(b));
            localStorage.setItem(ROSTER_KEY, JSON.stringify(rosterArray));
        }

        function validateIdFormat(id) {
            return /^\d{5}$/.test(id);
        }

        // -------------------------------------
        // 3. ëª…ë‹¨ ê´€ë¦¬ í•¨ìˆ˜
        // -------------------------------------
        
        function generateAndSaveInitialRoster() {
            const roster = [];
            for (let classNum = 1; classNum <= TOTAL_CLASSES; classNum++) {
                const classStr = String(classNum).padStart(2, '0');
                for (let studentNum = 1; studentNum <= STUDENTS_PER_CLASS; studentNum++) {
                    const studentStr = String(studentNum).padStart(2, '0');
                    roster.push(`1${classStr}${studentStr}`); 
                }
            }
            saveFullRoster(roster);
            updateRosterDisplay();
            updateDashboard();
            document.getElementById('roster-status').textContent = `âœ… ì´ˆê¸° ëª…ë‹¨ ${roster.length}ëª… (1í•™ë…„ ì „ì²´)ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.`;
        }

        function addStudent() {
            const inputElement = document.getElementById('roster-id-input');
            const newId = inputElement.value.trim();
            const statusElement = document.getElementById('roster-status');
            
            if (!validateIdFormat(newId)) {
                statusElement.textContent = `âš ï¸ í•™ë²ˆ ${newId}ëŠ” ìœ íš¨í•œ 5ìë¦¬ ìˆ«ì í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.`;
                return;
            }
            
            let roster = loadFullRoster();
            if (roster.includes(newId)) {
                statusElement.textContent = `âŒ í•™ë²ˆ ${newId}ëŠ” ì´ë¯¸ ëª…ë‹¨ì— ìˆìŠµë‹ˆë‹¤.`;
                return;
            }
            
            roster.push(newId);
            saveFullRoster(roster); 
            statusElement.textContent = `âœ… í•™ë²ˆ ${newId}ê°€ ëª…ë‹¨ì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.`;
            inputElement.value = '';
            updateRosterDisplay();
            updateDashboard();
        }
        
        function deleteStudent() {
            const inputElement = document.getElementById('roster-id-input');
            const deleteId = inputElement.value.trim();
            const statusElement = document.getElementById('roster-status');
            
            if (!validateIdFormat(deleteId)) {
                statusElement.textContent = `âš ï¸ í•™ë²ˆ ${deleteId}ëŠ” ìœ íš¨í•œ 5ìë¦¬ ìˆ«ì í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.`;
                return;
            }
            
            let roster = loadFullRoster();
            const initialLength = roster.length;
            
            roster = roster.filter(id => id !== deleteId);
            
            if (roster.length === initialLength) {
                statusElement.textContent = `âŒ í•™ë²ˆ ${deleteId}ëŠ” ëª…ë‹¨ì— ì—†ìŠµë‹ˆë‹¤.`;
                return;
            }
            
            saveFullRoster(roster); 
            statusElement.textContent = `âœ… í•™ë²ˆ ${deleteId}ê°€ ëª…ë‹¨ì—ì„œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`;
            inputElement.value = '';
            updateRosterDisplay();
            updateDashboard();
        }

        function updateRosterDisplay() {
            const roster = loadFullRoster();
            const displayElement = document.getElementById('roster-display');
            const setupSection = document.getElementById('roster-setup');

            document.getElementById('current-roster-count').textContent = roster.length;

            if (roster.length === 0) {
                displayElement.innerHTML = '<p style="text-align: center; color: #e74c3c;">í˜„ì¬ ë“±ë¡ëœ í•™ìƒì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                setupSection.style.display = 'block';
            } else {
                displayElement.innerHTML = roster.map(id => `<span style="padding-right: 10px; display: inline-block;">${id}</span>`).join('');
                setupSection.style.display = 'none';
            }
        }

        // -------------------------------------
        // 4. ëŒ€ì‹œë³´ë“œ ì—…ë°ì´íŠ¸ ë¡œì§
        // -------------------------------------
        function updateDashboard() {
            document.getElementById('current-date').textContent = new Date().toLocaleDateString('ko-KR');

            const fullRoster = loadFullRoster();
            const totalCount = fullRoster.length;
            
            const checkinData = loadCheckinData();
            const checkedCount = checkinData.length;
            const missingCount = totalCount - checkedCount;

            document.getElementById('total-count').textContent = totalCount;
            document.getElementById('checked-count').textContent = checkedCount;
            document.getElementById('missing-count').textContent = missingCount;

            const checkedIds = new Set(checkinData.map(item => item.id));
            const missingStudents = fullRoster.filter(id => !checkedIds.has(id));
            
            const missingListElement = document.getElementById('missing-students-list');
            missingListElement.innerHTML = missingStudents.length > 0
                ? missingStudents.map(id => `<span>${id}</span>`).join('')
                : '<p style="color: #27ae60; font-weight: bold;">ëª¨ë“  í•™ìƒì´ ì²´í¬ì¸ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤.</p>';

            const tableBody = document.getElementById('checkin-table-body');
            tableBody.innerHTML = ''; 

            checkinData.sort((a, b) => a.id.localeCompare(b.id)); 

            checkinData.forEach(item => {
                const id = item.id;
                const classNum = id.length >= 3 ? parseInt(id.substring(1, 3)) : '?'; 
                const studentNum = id.length === 5 ? parseInt(id.substring(3, 5)) : '?'; 
                
                const row = tableBody.insertRow();
                row.insertCell().textContent = id;
                row.insertCell().textContent = `${isNaN(classNum) ? '?' : classNum}ë°˜`;
                row.insertCell().textContent = `${isNaN(studentNum) ? '?' : studentNum}ë²ˆ`;
                row.insertCell().textContent = item.classroom; 
                row.insertCell().textContent = item.time;
            });
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ëŒ€ì‹œë³´ë“œ ë° ëª…ë‹¨ ì—…ë°ì´íŠ¸
        document.addEventListener('DOMContentLoaded', () => {
            updateRosterDisplay();
            updateDashboard();
        });
    </script>
</body>
</html>
